// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================



#include "GameListRowWidgetBase.h"

#include "Components/TextBlock.h"
#include "Components/Border.h"

#include "Packet/BasePacketAutoGenerated/PACKET_COMMON.h"

#include "SubSystem/UiServiceManager/UiServiceManager.h"
#include "UiService/Game/UiServiceGame.h"
#include "UiObject/RowData/UiRowDataGame.h"


void UGameListRowWidgetBase::NativeConstruct()
{
	Super::NativeConstruct();

	if (false == mBorder->OnMouseButtonUpEvent.IsBoundToObject(this))
	{
		mBorder->OnMouseButtonUpEvent.BindUFunction(this, FName(TEXT("OnClicked")));
	}
}

void UGameListRowWidgetBase::NativeDestruct()
{
	Super::NativeDestruct();
}

void UGameListRowWidgetBase::OnClicked()
{
	TSharedPtr<FUiServiceGame> gameService = UUiServiceManager::Get(this)->GetService<FUiServiceGame>();
	if (!gameService)
		return;

	gameService->SelectGame(mGameData);
}

void UGameListRowWidgetBase::NativeOnItemSelectionChanged(bool bIsSelected)
{
	if (bIsSelected)
		OnClicked();
}

void UGameListRowWidgetBase::NativeOnListItemObjectSet(UObject* ListItemObject)
{
	UUiRowDataGame* rowData = Cast<UUiRowDataGame>(ListItemObject);

	mGameData = rowData->mData;

	mGameId->SetText(FText::Format(FText::FromString(TEXT("mGameId {0}")), mGameData->Get_c_game_id().GetData()));
	mGameSid->SetText(FText::Format(FText::FromString(TEXT("mGameSid {0}")), mGameData->Get_c_game_sid()));
	mDateCreated->SetText(FText::Format(FText::FromString(TEXT("mDateCreated {0}")), mGameData->Get_c_date_created()));

	IUserObjectListEntry::NativeOnListItemObjectSet(ListItemObject);
}
