// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================

#include "Packet/StaticData/Reward/RewardDocLookup.h"

#include "Packet/BasePacketAutoGenerated/PACKET_COMMON.h"
#include "Packet/StaticDataAccessor/StaticDataAccessor.h"
#include "Packet/StaticDataCatalog/StaticDataCatalog.h"
#include "Packet/StaticData/Reward/RewardDoc.h"


RewardDocLookup::~RewardDocLookup()
{
	Clear();
}
void RewardDocLookup::Clear()
{
	for (auto& [_, doc] : mRewardDocMap)
	{
		_DELETE(doc);
	}
	mRewardDocMap.clear();
}

void RewardDocLookup::Load()
{
	for (auto& it : gStaticDataCatalog->GetList<STATIC_REWARD>())
	{
		auto key = it->Get_c_reward_sid();
		auto found = mRewardDocMap.find(key);
		RewardDoc* doc = (mRewardDocMap.end() != found) ?
			found->second : _NEW<RewardDoc>();		
		doc->mStaticReward = *it;
		mRewardDocMap.emplace(it->Get_c_reward_sid(), doc);
	}
}

void RewardDocLookup::Link()
{

}

const RewardDoc* RewardDocLookup::Find(RewardSid rewardSid) const
{
	const auto it = mRewardDocMap.find(rewardSid);

	if (mRewardDocMap.end() == it)
	{
		_DEBUG_BREAK;
		_DEBUG_RED;
		return nullptr;
	}

	return it->second;
}
