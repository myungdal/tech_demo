// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================

#include "Packet/StaticData/Stat/StatDocLookup.h"

#include "Packet/BasePacketAutoGenerated/PACKET_COMMON.h"
#include "Packet/StaticDataAccessor/StaticDataAccessor.h"
#include "Packet/StaticDataCatalog/StaticDataCatalog.h"
#include "Packet/StaticData/Stat/StatDoc.h"


StatDocLookup::StatDocLookup()
{
	mStatDocArray.fill(nullptr);
}
StatDocLookup::~StatDocLookup()
{
	Clear();
}
void StatDocLookup::Clear()
{
	for (StatDoc* doc : mStatDocArray)
	{
		if (nullptr != doc)
		{
			_DELETE(doc);
		}
	}
	mStatDocArray.fill(nullptr);
}

void StatDocLookup::Load()
{
	for (auto& it : gStaticDataCatalog->GetList<STATIC_STAT>())
	{
		auto key = it->Get_c_stat_type();
		size_t idx = static_cast<size_t>(key);
		if (mStatDocArray.size() <= idx)
		{
			_ASSERT_CRASH(false);
			continue;
		}		
		StatDoc* doc = (nullptr != mStatDocArray[idx]) ?
			mStatDocArray[idx] : _NEW<StatDoc>();
		doc->mStaticStat = *it;
		mStatDocArray[idx] = doc;
	}
}

void StatDocLookup::Link()
{
}

const StatDoc* StatDocLookup::Find(StatType statType) const
{
	size_t idx = static_cast<size_t>(statType);
	if (mStatDocArray.size() <= idx)
	{
		_DEBUG_BREAK;
		_DEBUG_RED;
		return nullptr;
	}	
	return mStatDocArray[idx];
}
