// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================

#pragma once

#include "Common/PCH/pch_common.h"
#include "Common/Key/StrongType/StrongType.h"

// 패킷 기본 타입 (PacketType, PacketSize, HandleResult 등)
// 모듈에서도 사용 가능하도록 별도 헤더로 분리됨
#include "Packet/PacketFundamentals/PacketFundamentals.h"

#include "Packet/PacketCapsule/PacketString/PacketString.h"
#include "Packet/PacketCapsule/PacketKeep/PacketKeep.h"
#include "Packet/PacketCapsule/PacketTemp/PacketTemp.h"

#include "Packet/ItemProperty/ItemColorUnion.h"
#include "Packet/ItemProperty/ItemEnchantUnion.h"
#include "Packet/ItemProperty/ItemStatUnion.h"


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Encryption
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

enum class EncryptionOption : uint8_t
{
	ENCRYPTION = 0,
	NO_ENCRYPTION
};

using EncryptionKey = uint32_t;


template<typename _CharType>
struct std::formatter<Checksum, _CharType> {
	constexpr auto parse(auto& ctx) { return ctx.end(); }
	auto format(const Checksum& t, auto& ctx) const {
		std::wstring result = L"";
		tTabStr += std::wstring(L"\t");
		result += std::format(L"\n{}checksum0: {}", tTabStr, t.checksum0);
		result += std::format(L"\n{}checksum1: {}", tTabStr, t.checksum1);
		result += std::format(L"\n{}checksum2: {}", tTabStr, t.checksum2);
		result += std::format(L"\n{}checksum3: {}", tTabStr, t.checksum3);
		tTabStr.pop_back();
		return std::ranges::copy(result, ctx.out()).out;
	}
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// 패킷 기본 타입은 PacketFundamentals.h에서 정의됨
// - PacketType, INVALID_PACKET_TYPE
// - PacketSize, INVALID_PACKET_SIZE, MAX_PACKET_*
// - PacketTraitType, PacketTraitNotify, PacketTraitReq, PacketTraitAck, PacketTraitParam
// - NOTIFY, REQ, ACK, PARAM
// - HandleResult
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Db Common
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using DbShardIdx = int64_t;
constexpr DbShardIdx INVALID_DB_SHARD_IDX = -1;

using DbSeq = uint64_t;
constexpr DbSeq INVALID_DB_SEQ = 0;

constexpr Uuid INVALID_UUID = Uuid(0);

using UserAchievementRowPtr = std::shared_ptr<class UserAchievementRow>;
using UserCharacterRowPtr = std::shared_ptr<class UserCharacterRow>;
using UserItemRowPtr = std::shared_ptr<class UserItemRow>;
using UserMissionRowPtr = std::shared_ptr<class UserMissionRow>;
using UserQuestRowPtr = std::shared_ptr<class UserQuestRow>;
using UserItemStatRowPtr = std::shared_ptr<class UserItemStatRow>;

using UserAchievementTablePtr = std::shared_ptr<class UserAchievementTable>;
using UserCharacterTablePtr = std::shared_ptr<class UserCharacterTable>;
using UserItemTablePtr = std::shared_ptr<class UserItemTable>;
using UserMissionTablePtr = std::shared_ptr<class UserMissionTable>;
using UserQuestTablePtr = std::shared_ptr<class UserQuestTable>;
using UserItemStatTablePtr = std::shared_ptr<class UserItemStatTable>;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Activity
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using ActivityId = Uuid;

using ActivityPoint = int64_t;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Reward
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using RewardValue = int64_t;

using Ratio = RewardValue;

using Probability = RewardValue;

constexpr size_t INVALID_REWARD_GROUP_IDX = SIZE_MAX;

using RewardFlag = int64_t; // 癰귣똻湲쎌뱽 獄쏆룇釉뮉筌 肉ч겫

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Purchase
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using PurchaseId = Uuid;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Achievement
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using AchievementId = Uuid;

using AchievementStep = int64_t;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Quest
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using QuestId = Uuid;

using QuestChapter = int64_t;
using QuestIndex = int64_t;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Mission
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using MissionId = Uuid;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Account
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using AccountId = Uuid;

using AuthTicket = uint64_t;
constexpr AuthTicket INVALID_AUTH_TICKET = 0;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Server
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using ServerId = int64_t;
constexpr ServerId INVALID_SERVER_ID = 0;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// User
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using UserCacheIdx = uint64_t;

using UserId = Uuid;
using UserIdList = std::vector<UserId>;

using UserCacheSeq = int64_t;

using UserLevel = int64_t;
constexpr UserLevel INVALID_USER_LEVEL = 0;
constexpr UserLevel MIN_USER_LEVEL = 1;
constexpr UserLevel MAX_USER_LEVEL = 100;

using UserExp = int64_t;
constexpr UserExp MAX_USER_EXP = 999'999'999'999'999;

using UserRank = int64_t;

constexpr wchar_t MIN_USER_NAME_LEN = 4;
constexpr wchar_t MAX_USER_NAME_LEN = 16;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Guild
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using GuildId = Uuid;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Party
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using PartyId = Uuid;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Mail
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using MailId = Uuid;

constexpr size_t LIMIT_MAIL_LIST_COUNT = 30;
using MailIdList = std::vector<MailId>;

using ReadFlag = int64_t;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Item
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using ItemId = Uuid;

using ItemLevel = int64_t;
constexpr ItemLevel MIN_ITEM_LEVEL = 0;
constexpr ItemLevel MAX_ITEM_LEVEL = 9;

using ItemQuantity = int64_t;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Character
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Building
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Product
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using ProductId = Uuid;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Stock
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using StockSlot = int64_t;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Game World 꽴졃
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using SkillIndex = int64_t;
using SkillSpan = Span; // Span TimeStep
using SkillPower = int64_t; // 1024 = 100%

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Room
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using RoomId = Uuid;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// GameChannel
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using GameId = Uuid;

using GameChannelCount = int64_t;
using GameChannelIndex = int64_t;
constexpr GameChannelIndex INVALID_GAME_CHANNEL_INDEX = -1;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// App
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//
using AppArg = int32_t;
constexpr AppArg DEFAULT_APP_ARG = 0;

using AppId = int64_t;
constexpr AppId INVALID_APP_ID = -1;
constexpr AppId MAX_APP_COUNT = 256;
using AppIdList = std::vector<AppId>;
using AppIdTable = std::array<AppIdList, _IDX(AppType::MAX)>;

using BotScenarioId = int64_t;

// AppConfigManager
using StaticDataIndex = int64_t;
constexpr StaticDataIndex INVALID_STATIC_DATA_INDEX = -1;
using StaticDataIndexList = std::vector<StaticDataIndex>;

using StaticDataSize = int64_t;
using WorldDataSize = int64_t;

using UserCount = int64_t;

struct GameData
{
	AppId mAppId = INVALID_APP_ID;
	GameId mGameId = INVALID_UUID;
	GameSid mGameSid = INVALID_SID;
	GameChannelIndex mGameChannelIndex = INVALID_GAME_CHANNEL_INDEX;
	UserId mOwnerUserId = INVALID_UUID;
	time_t mDateCreated = 0;
};

using GameDataPtr = std::shared_ptr<GameData>;

using GameDataMap = std::map<GameId, GameDataPtr, std::greater<>>;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Log
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using LogId = Uuid;
