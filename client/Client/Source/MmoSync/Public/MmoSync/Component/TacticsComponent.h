// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================

#pragma once

#include "MmoSync/ComponentBase/ComponentBase.h"
#include "Common/EnumAutoGenerated/Enum.h"


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// 상태
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#pragma pack(push, 1)
struct TacticsComponentGroup : Component<TacticsComponentGroup> 
{
};

// 전투 상태 ? 적을 추격하며, 체력이 50% 이하가 되면 도망 상태로. 적이 없거나 영역 밖으로 나가면 회귀 상태로 전환.
struct TacticsComponentCombat : Component<TacticsComponentCombat, TacticsComponentGroup> 
{
	Span remainedDuration = 0;
};

// 회귀 상태 ? 거점으로 돌아가는 중.쿨다운이 완료되고 적이 있으면 전투 상태로 전환.
struct TacticsComponentReturn : Component<TacticsComponentReturn, TacticsComponentGroup> 
{
	Span remainedDuration = 0;
};

// 대기 상태 ? 가만히 있음.적을 만나면 전투 상태로 전환.
struct TacticsComponentIdle : Component<TacticsComponentIdle, TacticsComponentGroup> 
{
	Span remainedDuration = 0;
};

// 탐색 상태 ? 거점 주변을 탐색.도착 시 IDLE 상태로, 적을 만나면 전투 상태로 전환.
struct TacticsComponentRoaming : Component<TacticsComponentRoaming, TacticsComponentGroup> 
{
	Span remainedDuration = 0;
};

// 도망 상태 ? 적 반대 방향으로 이동하며 회복.체력이 10 % 이하로 떨어지면 전투 상태로, 70 % 이상이면 선공 상태로.
struct TacticsComponentFlee : Component<TacticsComponentFlee, TacticsComponentGroup> 
{
	Span remainedDuration = 0;
};
#pragma pack(pop)


template<typename _CharType>
struct std::formatter<TacticsComponentGroup, _CharType> {
	constexpr auto parse(auto& ctx) { return ctx.end(); }
	auto format(MAYBE_UNUSED const TacticsComponentGroup& t, auto& ctx) const {
		std::wstring result = L"";
		tTabStr += std::wstring(L"\t");
		result += std::format(L"\n{}", tTabStr);
		tTabStr.pop_back();
		return std::ranges::copy(result, ctx.out()).out;
	}
};

template<typename _CharType>
struct std::formatter<TacticsComponentCombat, _CharType> {
	constexpr auto parse(auto& ctx) { return ctx.end(); }
	auto format(const TacticsComponentCombat& t, auto& ctx) const {
		std::wstring result = L"";
		tTabStr += std::wstring(L"\t");
		result += std::format(L"\n{}remainedDuration: {}", tTabStr, t.remainedDuration);
		tTabStr.pop_back();
		return std::ranges::copy(result, ctx.out()).out;
	}
};

template<typename _CharType>
struct std::formatter<TacticsComponentReturn, _CharType> {
	constexpr auto parse(auto& ctx) { return ctx.end(); }
	auto format(const TacticsComponentReturn& t, auto& ctx) const {
		std::wstring result = L"";
		tTabStr += std::wstring(L"\t");
		result += std::format(L"\n{}remainedDuration: {}", tTabStr, t.remainedDuration);
		tTabStr.pop_back();
		return std::ranges::copy(result, ctx.out()).out;
	}
};

template<typename _CharType>
struct std::formatter<TacticsComponentIdle, _CharType> {
	constexpr auto parse(auto& ctx) { return ctx.end(); }
	auto format(const TacticsComponentIdle& t, auto& ctx) const {
		std::wstring result = L"";
		tTabStr += std::wstring(L"\t");
		result += std::format(L"\n{}remainedDuration: {}", tTabStr, t.remainedDuration);
		tTabStr.pop_back();
		return std::ranges::copy(result, ctx.out()).out;
	}
};

template<typename _CharType>
struct std::formatter<TacticsComponentRoaming, _CharType> {
	constexpr auto parse(auto& ctx) { return ctx.end(); }
	auto format(const TacticsComponentRoaming& t, auto& ctx) const {
		std::wstring result = L"";
		tTabStr += std::wstring(L"\t");
		result += std::format(L"\n{}remainedDuration: {}", tTabStr, t.remainedDuration);
		tTabStr.pop_back();
		return std::ranges::copy(result, ctx.out()).out;
	}
};

template<typename _CharType>
struct std::formatter<TacticsComponentFlee, _CharType> {
	constexpr auto parse(auto& ctx) { return ctx.end(); }
	auto format(const TacticsComponentFlee& t, auto& ctx) const {
		std::wstring result = L"";
		tTabStr += std::wstring(L"\t");
		result += std::format(L"\n{}remainedDuration: {}", tTabStr, t.remainedDuration);
		tTabStr.pop_back();
		return std::ranges::copy(result, ctx.out()).out;
	}
};
