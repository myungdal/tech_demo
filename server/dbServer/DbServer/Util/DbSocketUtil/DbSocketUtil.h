// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================

#pragma once

#include "Packet/NetworkPacketAutoGenerated/PacketFwd.h"

#include "ServerEngine/Util/SocketUtil/SocketUtil.h"
#include "DbServer/Socket/SocketDbToLog.h"


class SocketDbToMain;
class SocketDbFromGame;

struct DbSocketUtil
{
	static SocketPtr<SocketDbToMain> GetMainSocketPtr();
	static SocketPtr<SocketDbFromGame> GetGameSocket(AppId gameAppId);

	template <typename _Packet>
	using SendToClient = SocketUtil::SendBypass<DF_ACK_DC_BYPASS::Writer, _Packet>;

	template<typename _Packet>
	class SendLog : public _Packet
	{
	public:
		template<typename... _Args>
		explicit SendLog(_Args&&... args)
			:
			_Packet(NOTIFY, SendBuffer::Pop(__FUNCTIONW__), std::forward<_Args>(args)...)
		{
		}

		virtual ~SendLog()
		{
			if (gSocketDbToLog)
			{
				gSocketDbToLog->Send(*this);
			}
		}
	};
};
