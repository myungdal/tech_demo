// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================

#pragma once

#include "Packet/BasePacketAutoGenerated/PACKET_COMMON.h"


class UserCacheAccessor;
class SERVER;
class ACCOUNT_USER;

using ServerList = std::list<PacketKeep<SERVER>>;
using AccountUserList = std::list<PacketKeep<ACCOUNT_USER>>;
using GameMap = std::unordered_map<GameId, PacketKeep<GAME>>;

// 봇의 세션 상태를 보관하는 컨텍스트 클래스
class BotContext
{
private:
	PacketHeader mCurrPacketHeader;
	ServerList mServerList;
	AccountUserList mAccountUserList;

	AuthTicket mAuthTicket = INVALID_AUTH_TICKET;

	Checksum mStaticDataChecksum;
	std::shared_ptr<UserCacheAccessor> mUserCacheAccessor = nullptr;

	GameMap mGameMap;
	GameId mLastGameId = INVALID_UUID;
	GameId mNextGameId = INVALID_UUID;
	GameId mCurrGameId = INVALID_UUID;

public:
	BotContext();

public:
	PacketHeader& CurrPacketHeader() { return mCurrPacketHeader; }

	ServerList& ServerList() { return mServerList; }
	AccountUserList& AccountUserList() { return mAccountUserList; }
	AuthTicket& AuthTicket() { return mAuthTicket; }
	Checksum& StaticDataChecksum() { return mStaticDataChecksum; }

	UserCacheAccessor& GetUserCache() { return *mUserCacheAccessor; }

	GameMap& GetGameMap() { return mGameMap; }
	GameId& LastGameId() { return mLastGameId; }
	GameId& NextGameId() { return mNextGameId; }
	GameId& CurrGameId() { return mCurrGameId; }

	UserItemRowPtr FindItemIdByItemSid(ItemSid itemSid) const;
};
