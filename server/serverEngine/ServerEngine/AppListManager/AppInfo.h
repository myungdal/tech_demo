// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================

// AppInfo.h - 앱 정보 클래스
#pragma once

#include "Packet/BasePacketAutoGenerated/PACKET_COMMON.h"

#include "ServerEngine/Socket/SocketBase/SocketBase.h"


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// AppInfo
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// 앱 정보 (AppListManager에서 관리)
class AppInfo
{
private:
	// 앱 데이터 (패킷 형태로 보관)
	PacketKeep<APP_DATA> mData;

	// 앱과 연결된 소켓 (약한 참조)
	mutable SocketBaseWeakPtr mSocketWeakPtr;

	// 게임 채널 개수 (AppType::GAME_SERVER 전용)
	size_t mGameChannelCount = 0;

public:
	// 앱 데이터 설정
	void SetData(const APP_DATA& data) { mData = data; }
	
	// 앱 데이터 조회
	APP_DATA& GetData() { return **mData; }

	// 소켓 설정
	void SetSocket(SocketBasePtr socket, const wchar_t* reason) 
	{ 
		mSocketWeakPtr.Set(socket, reason); 
	}
	
	// 소켓 조회
	SocketBasePtr GetSocket() { return mSocketWeakPtr.Lock(); }

	// 게임 채널 개수 증가
	void IncreaseGameChannelCount() { ++mGameChannelCount; }
	
	// 게임 채널 개수 감소
	void DecreaseGameChannelCount() { --mGameChannelCount; }
	
	// 게임 채널 개수 조회
	size_t GetGameChannelCount() const { return mGameChannelCount; }
};
