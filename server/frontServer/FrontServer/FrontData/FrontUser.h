// ============================================================================
// myungdal tech-demo project
// 
// Author: 안명달 (Myungdal Ahn)
// Email: mooondal@gmail.com
// GitHub: https://github.com/myungdal/tech_demo.git
// ============================================================================

#pragma once

#include "Packet/BasePacketAutoGenerated/PACKET_COMMON.h"
#include "ServerEngine/Socket/SocketPtr/SocketWeakPtr.h"


class ACCOUNT_USER;
class USER;
class PacketHeader;
class SocketFrontFromClient;
class SocketFrontToGame;

// 프론트 서버에서 관리하는 유저 정보
class FrontUser
{
private:
	PacketKeep<ACCOUNT_USER> mAccountUser;
	PacketKeep<USER> mUser;
	PacketHeader mCurrPacketHeader;

	// 채팅 관련 데이터
	ClockMs mCurrentChattingTime = 0ms;
	ClockMs mNextChattingDelay = DEFAULT_CHATTING_DELAY;

	// 소켓 WeakPtr (순환 참조 방지)
	SocketWeakPtr<SocketFrontFromClient> mClientSocketWeakPtr = nullptr;
	SocketWeakPtr<SocketFrontToGame> mGameSocketWeakPtr = nullptr;

public:
	// 유저 데이터 설정/조회
	void SetUser(const ACCOUNT_USER& accountUser, const USER& user);
	const ACCOUNT_USER& LoadAccountUser() const { return **mAccountUser; }
	const USER& GetUser() const { return **mUser; }

	// 패킷 헤더 설정/조회
	void SetCurrPacketHeader(const PacketHeader& info) { mCurrPacketHeader = info; }
	const PacketHeader& GetCurrPacketHeader() const { return mCurrPacketHeader; }

	// 채팅 시간 설정/조회
	ClockMs GetCurrentChattingTime() const { return mCurrentChattingTime; }
	void SetCurrentChattingTime(ClockMs time) { mCurrentChattingTime = time; }
	ClockMs GetNextChattingDelay() const { return mNextChattingDelay; }
	void SetNextChattingDelay(ClockMs delay) { mNextChattingDelay = delay; }

	// 소켓 설정/조회
	void SetClientSocket(SocketPtr<SocketFrontFromClient> socket);
	void SetGameSocket(SocketPtr<SocketFrontToGame> socket);
	SocketPtr<SocketFrontFromClient> GetClientSocket();
	SocketPtr<SocketFrontToGame> GetGameSocket();
};
