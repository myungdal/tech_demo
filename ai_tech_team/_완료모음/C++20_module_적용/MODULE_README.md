# ServerEngine C++20 Module 전환 프로젝트

## 프로젝트 개요

ServerEngine과 모든 서버 프로젝트를 **C++20 Module**로 전환하여:
- **빌드 시간 30-50% 단축**
- **헤더 의존성 제거**
- **매크로 오염 방지**
- **명확한 모듈 경계**

## 현재 상태: 경량 모듈 체계 완료

### 모듈 구조 (10개 경량 모듈)

```
ServerEngineCore     - TLS, Lock, Clock, Exception, Core 타입
ServerEngineWorker   - Worker, Thread 시스템
ServerEngineDb       - DbConnection, DbSession
ServerEngineNetwork  - Socket, Network, SendBuffer
ServerEngineLog      - Log, LogQueue, LogWriter
ServerEngineApp      - AppBase, AppConfig, Http
ServerEngineUtil     - StringUtil, TimeUtil, NetworkUtil 등 (경량)
ServerEngineDev      - DevPacketConverter (디버그용)
ServerEnginePacket   - StaticData, UserCache, Doc/DocLookup (14종)
ServerEngineCommon   - Random, Stat, Math, FlowControlScript 등 Common 프로젝트
```

### 직접 #include 필요 (템플릿)
```
PacketUtil  - 템플릿 함수만 있어 모듈 export 불가
DbUtil      - 템플릿 함수만 있어 모듈 export 불가
```

### 우산 모듈 사용 금지

```cpp
// ? 금지 - obj 파일 4GB 초과 위험
import ServerEngine;

// ? 권장 - 프로젝트 모듈만 import
import MainServer;
import FrontServer;
// 등...
```

## 사용 규칙

### 1. 프로젝트 .cpp 파일

```cpp
#include "FrontServer/PCH/pch_module.h"  // 모듈용 PCH

import FrontServer;  // 프로젝트 모듈만 import

#include "FrontServer/Socket/SocketFrontFromClient.h"
// ServerEngine/* include 불필요!
```

### 2. 프로젝트 .ixx 파일

```cpp
module;

#include "Packet/PCH/pch_packet.h"
#include "FrontServer/App/FrontServerApp.h"
// ... 필요한 헤더들

export module FrontServer;

// 필요한 ServerEngine 모듈만 import
import ServerEngineCore;
import ServerEngineNetwork;
import ServerEngineWorker;
import ServerEngineUtil;
import ServerEngineApp;

export
{
    using ::FrontServerApp;
    // ... exports
}
```

### 3. DbUtil 사용 파일 (기존 방식 유지)

```cpp
#include "MainServer/PCH/pch.h"  // 기존 PCH

#include "ServerEngine/DbSpAutoGenerated/SP_SERVER.h"
#include "ServerEngine/Util/DbUtil/DbUtil.h"
```

## 프로젝트 구조

### 모듈 파일

```
server/
├── serverEngine/
│   ├── ServerEngine.ixx        # 우산 모듈 (레거시 - 사용 금지)
│   ├── ServerEngineCore.ixx    # Core, TLS, Lock, Clock, Exception
│   ├── ServerEngineWorker.ixx  # Worker, Thread
│   ├── ServerEngineDb.ixx      # Database
│   ├── ServerEngineNetwork.ixx # Network, Socket
│   ├── ServerEngineLog.ixx     # Logging
│   ├── ServerEngineApp.ixx     # AppBase, AppConfig, Http
│   ├── ServerEngineUtil.ixx    # Utilities
│   ├── ServerEngineDev.ixx     # DevPacketConverter
│   └── ServerEnginePacket.ixx  # StaticData, UserCache
│
├── mainServer/MainServer.ixx
├── frontServer/FrontServer.ixx
├── gameServer/GameServer.ixx
├── dbServer/DbServer.ixx
├── logServer/LogServer.ixx
├── bridgeServer/BridgeServer.ixx
├── shell/Shell.ixx
├── bot/Bot.ixx
└── test/Test.ixx
```

## 전환 현황

### 프로젝트별 상태

| 프로젝트 | 상태 | import 방식 |
|----------|------|-------------|
| ServerEngine | ? 모듈 제공자 | - |
| MainServer | ? 완료 | import MainServer; |
| FrontServer | ? 완료 | import FrontServer; |
| GameServer | ? 완료 | import GameServer; |
| Bot | ? 완료 | import Bot; |
| Shell | ? 완료 | import Shell; |
| LogServer | ? 완료 | import LogServer; |
| BridgeServer | ? 완료 | import BridgeServer; |
| DbServer | ? 완료 | import DbServer; |
| Test | ? 완료 | import Test; |

## 중요 주의사항

### 1. `import ServerEngine;` 절대 금지

```cpp
// ? 이렇게 하면 C1605 에러 (obj 4GB 초과)
import ServerEngine;

// ? 프로젝트 모듈만 사용
import MainServer;
```

### 2. 경량 모듈 조합 가이드

| 용도 | 필요한 모듈 |
|------|-------------|
| Socket 계열 | Core + Network + Worker + Util (+App) |
| PacketHandler 계열 | Core + Worker + Util (+Db) |
| App/main 계열 | Core + Network + Worker + Util + App (+Db, +Log) |
| GameChannel 계열 | Core + Worker + Util + App |
| Util 계열 | Core + Network + Util |

### 3. 매크로/네임스페이스는 PCH에서 제공

```cpp
// 모듈에서 매크로 export 불가 - PCH 체인이 제공
// 네임스페이스도 동일
```

### 4. StaticData/UserCache 사용 (ServerEnginePacket)

```cpp
#include "DbServer/PCH/pch_module.h"

import DbServer;
import ServerEnginePacket;  // StaticData 기반 + UserCache 타입 제공 (경량화)

// gStaticDataListHolder, gStaticDataAccessor 사용 가능
// UserCacheAccessor, UserItemTable, UserItemRow 등 사용 가능
```

**Doc/DocLookup도 모듈에서 제공**:

`import ServerEnginePacket;`만으로 모든 Doc/DocLookup 타입 사용 가능:
- `ItemDoc`, `ItemDocLookup`, `GameDoc`, `GameDocLookup` 등 14종 모두 export됨
- 별도 `#include` 불필요

### 5. Include 방식 유지 대상

- `Packet/NetworkPacketAutoGenerated/` - 자동 생성 패킷 (클라이언트 공유)
- `Common/` - Unreal Engine 호환
- `MMOSync/` - Unreal Engine 호환
- `DbSpAutoGenerated/` - 자동 생성
- `DbUtil` 사용 파일

## 삭제된 레거시 파일

다음 파티션 모듈은 경량 모듈로 통합되어 삭제됨:
- ServerEngine-Core.ixx → ServerEngineCore.ixx
- ServerEngine-Worker.ixx → ServerEngineWorker.ixx
- ServerEngine-DB.ixx → ServerEngineDb.ixx
- ServerEngine-Network.ixx → ServerEngineNetwork.ixx
- ServerEngine-Socket.ixx → ServerEngineNetwork.ixx
- ServerEngine-Log.ixx → ServerEngineLog.ixx
- ServerEngine-AppBase.ixx → ServerEngineApp.ixx
- ServerEngine-Http.ixx → ServerEngineApp.ixx
- ServerEngine-PacketTransactor.ixx → ServerEngineApp.ixx
- ServerEngine-Util.ixx → ServerEngineUtil.ixx
- ServerEngine-Lock.ixx → ServerEngineCore.ixx
- ServerEngine-Clock.ixx → ServerEngineCore.ixx
- ServerEngine-TLS.ixx → ServerEngineCore.ixx
- ServerEngine-Thread.ixx → ServerEngineWorker.ixx
- ServerEngine-Exception.ixx → ServerEngineCore.ixx

## 빌드 테스트 결과

| 항목 | 결과 |
|------|------|
| ServerEngine 빌드 | ? 성공 |
| 전체 서버 빌드 | ? 성공 |
| 프로젝트 모듈 import | ? 성공 |
| C1605 에러 해결 | ? 성공 |

## 예상 효과

**모듈 전환 후**:
```
빌드 시간:
- 전체 빌드: 30-50% 단축
- 재빌드: 50-70% 단축
- 일부 수정: 70-90% 단축
```
